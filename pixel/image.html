<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Test load ·∫£nh XOR (JS thu·∫ßn)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding-top: 50px;
    }
    img {
      margin-top: 20px;
      border: 2px solid #fff;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <h2>üí´ Test ·∫£nh gi·∫£i m√£ b·∫±ng JavaScript thu·∫ßn üí´</h2>
  <div id="output">ƒêang t·∫£i ·∫£nh...</div>

  <script>
    // M·∫£ng kh√≥a gi·ªëng bn.java [-22, 2, 12, 4, 5, 2, -10]
    const KEY = [234, 2, 12, 4, 5, 2, 246];

    // H√†m gi·∫£i m√£ XOR buffer
    function xorDecode(arrayBuffer) {
      const input = new Uint8Array(arrayBuffer);
      const output = new Uint8Array(input.length);
      let keyIndex = 0;
      for (let i = 0; i < input.length; i++) {
        output[i] = input[i] ^ (KEY[keyIndex++] & 0xff);
        if (keyIndex >= KEY.length) keyIndex = 0;
      }
      return output;
    }

    // H√†m load ·∫£nh
    async function loadDecodedImage(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("HTTP " + res.status);
        const buf = await res.arrayBuffer();

        // Gi·∫£i m√£
        const decoded = xorDecode(buf);
        const blob = new Blob([decoded], { type: "image/png" });
        const imgURL = URL.createObjectURL(blob);

        const img = document.createElement("img");
        img.src = imgURL;
        img.onload = () => URL.revokeObjectURL(imgURL);
        document.getElementById("output").innerHTML = "";
        document.getElementById("output").appendChild(img);
      } catch (e) {
        document.getElementById("output").innerHTML = "‚ùå L·ªói khi t·∫£i ho·∫∑c gi·∫£i m√£ ·∫£nh: " + e.message;
      }
    }

    // G·ªçi th·ª≠ (·∫£nh n·∫±m trong th∆∞ m·ª•c x/)
    loadDecodedImage("https://dchinhdz.github.io/x/sprite.png");
  </script>
</body>
</html>
